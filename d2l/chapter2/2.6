import torch
from torch.distributions import multinomial
from d2l import torch as d2l

fair_probs = torch.ones([6]) / 6
#对于Multinoimal函数，第一个参数是采样次数，第二个参数是概率，这里里面也可以采样多个分布
#返回的张量形状取决于输入：
#如果probs形状为[num_categories]，返回[num_categories]
#如果probs形状为[batch_size, num_categories]，返回[batch_size, num_categories]
#每个样本向量中的元素和等于total_count
result1 = multinomial.Multinomial(1 , fair_probs).sample()
print(result1)

#对这个概率分布采样10次
result2 = multinomial.Multinomial(10 , fair_probs).sample()
print(result2)

#计算相对频率来对真实概率的估计(假设采样1000次)
count = multinomial.Multinomial(1000 , fair_probs).sample() / 1000
print(count)

###设置500组实验，可以看到最后收敛在了真实概率
#输出向量的shape为[500 , 6]
counts = multinomial.Multinomial(10, fair_probs).sample((500 , ))
#对每一列的元素累加求和
cum_counts = counts.cumsum(dim = 0)
#得到频率
estimates = cum_counts / cum_counts.sum(dim = 1 , keepdim = True)
#绘制图片
d2l.set_figsize((6, 4.5))
for i in range(6):
    d2l.plt.plot(estimates[:, i].numpy(),
                 label=("P(die=" + str(i + 1) + ")"))
d2l.plt.axhline(y=0.167, color='black', linestyle='dashed')
d2l.plt.gca().set_xlabel('Groups of experiments')
d2l.plt.gca().set_ylabel('Estimated probability')
d2l.plt.legend()
d2l.plt.show()
